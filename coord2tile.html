<!DOCTYPE html>
<html>
<head></head>
<script>
    var radeg = 180./Math.PI;

    function doMath(a, d) {
        return a + d;
    }

    function ang2pix_ring(theta, phi) {
        // nside is hardwired for now
        var nside = 64;
        var pion2 = Math.PI/2.;
        var twopi = Math.PI*2.;
        var nl2 = 2*nside;
        var nl4 = 4*nside;
        var npix = 12*nside*nside;
        var ncap = nl2*(nside-1);

        var cth0 = 2./3.;
        var cth_in = Math.cos(theta);
        var phi_in = phi % twopi;
        if (phi_in <= 0) {
            phi_in = phi_in + twopi;
        }
     
        var is_eqt = (cth_in <= cth0) && (cth_in > -cth0);
        var is_np = (cth_in > cth0);
        var is_sp = (cth_in <= -cth0);

        if (is_eqt) {
            var tt = phi_in/pion2;
            var jp = ~~(nside*(0.5 + tt - cth_in*0.75));
            var jm = ~~(nside*(0.5 + tt + cth_in*0.75));

            var ir = (nside + 1) + jp - jm;
            var k = +((ir % 2) == 0);

            var ip = ((jp+jm+k+(1-nside))/2) + 1;
            var ip = ~~(ip - nl4*(+(ip > nl4)));

            var ipring = ncap + nl4*(ir-1) + ip - 1;
        }
        if (is_np) {
            var tt = phi_in/pion2;

            var tp = (tt % 1.);
            var tmp = Math.sqrt(3.*(1.-Math.abs(cth_in)));

            var jp = ~~(nside*tp*tmp);
            var jm = ~~(nside*(1.-tp)*tmp);

            var ir = jp + jm + 1;
            var ip = ~~(tt*ir) + 1;
            var ir4 = 4*ir;
            var ip = ip - ir4*(+(ip > ir4));

            var ipring = 2*ir*(ir-1) + ip - 1;
        }
        if (is_sp) {
            var ipring = -1;
        }
        return ipring;
    }

    function ad2tp(a, d) {
        // convert (ra,dec) to (theta, phi)
        var theta = (90.-d)/radeg;
        var phi = a/radeg;
        return [theta, phi];
    }

    function displayTile() {
        var a = parseFloat(document.getElementById("ra").value);
        var d = parseFloat(document.getElementById("dec").value);
        if (isNaN(a) || isNaN(d) || (a < 0) || (a > 360) || (d < -90) || (d > 90)) {
            var s = "invalid input";
        } else {
            var tp = ad2tp(a,d);
            var s = ang2pix_ring(tp[0], tp[1]);
        }
        document.getElementById("calc").innerHTML = "healpix pixel: " + String(s);
    }
</script>
<body>
    
<h1>Calculator</h1>

    <form>
        <table>
            <tr>
                <td>RA (degrees J2000):
                    <input type="text" id="ra">
                </td>
                <td>Dec (degrees J2000):
                    <input type="text" id="dec">
                </td>
            </tr>
        </table>
    </form>
    <p id="calc">output</p>
    <button type="button" onclick="displayTile()">Calculate</button>
</body>
</html>
